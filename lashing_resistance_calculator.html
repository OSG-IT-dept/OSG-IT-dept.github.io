<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Lashing Resistance Calculator 3D</title>
<style>
  body {margin:0; background:#0b1020; color:#e8eeff; font-family:system-ui,sans-serif;}
  .ui {position:fixed; top:10px; left:10px; background:#121832cc; padding:12px; border-radius:10px; max-width:260px;}
  label {display:block; margin-top:8px; color:#b4c3ff;}
  input,select,button {width:100%; padding:6px; border-radius:6px; border:1px solid #2a366f; background:#0d1430; color:#e8eeff;}
  button {background:#7aa2ff; color:#0b1020; font-weight:bold; cursor:pointer; margin-top:10px;}
  #render {width:100vw; height:100vh; display:block;}
</style>
</head>
<body>
<div class="ui">
  <h3>Lashing Resistance 3D</h3>
  <label>Angle to Deck (°)</label>
  <input id="angleDeck" type="number" value="45">
  <label>Angle to Cargo (°)</label>
  <input id="angleCargo" type="number" value="10">
  <label>Lashings per side</label>
  <input id="num" type="number" value="2">
  <button id="update">Update View</button>
</div>
<canvas id="render"></canvas>

<script src="https://cdn.jsdelivr.net/npm/three@0.161.0/build/three.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/three@0.161.0/examples/js/controls/OrbitControls.min.js"></script>
<script>
let scene,camera,renderer,controls;
const canvas=document.getElementById('render');

init();
drawLashings();

function init(){
  scene=new THREE.Scene();
  scene.background=new THREE.Color(0x0b1020);
  camera=new THREE.PerspectiveCamera(55,window.innerWidth/window.innerHeight,1,1000);
  camera.position.set(5,3,6);

  renderer=new THREE.WebGLRenderer({canvas,antialias:true});
  renderer.setSize(window.innerWidth,window.innerHeight);
  window.addEventListener('resize',()=>renderer.setSize(window.innerWidth,window.innerHeight));

  controls=new THREE.OrbitControls(camera,renderer.domElement);
  controls.target.set(0,1,0);
  controls.update();

  // Light
  const ambient=new THREE.AmbientLight(0xffffff,0.7);
  scene.add(ambient);
  const dir=new THREE.DirectionalLight(0xffffff,0.8);
  dir.position.set(5,5,5);
  scene.add(dir);

  // Deck
  const deckGeom=new THREE.PlaneGeometry(20,10);
  const deckMat=new THREE.MeshStandardMaterial({color:0x1a203f,side:THREE.DoubleSide});
  const deck=new THREE.Mesh(deckGeom,deckMat);
  deck.rotation.x=-Math.PI/2;
  scene.add(deck);

  // Cargo block
  const cargoGeom=new THREE.BoxGeometry(2,1,2);
  const cargoMat=new THREE.MeshStandardMaterial({color:0x2b3d77,metalness:0.1,roughness:0.8});
  const cargo=new THREE.Mesh(cargoGeom,cargoMat);
  cargo.position.set(0,0.5,0);
  scene.add(cargo);

  animate();
}

function animate(){
  requestAnimationFrame(animate);
  renderer.render(scene,camera);
}

function clearLashings(){
  const remove=[];
  scene.traverse(obj=>{
    if(obj.userData && obj.userData.lashing) remove.push(obj);
  });
  remove.forEach(obj=>scene.remove(obj));
}

function drawLashings(){
  clearLashings();
  const angleDeck=parseFloat(document.getElementById('angleDeck').value)*Math.PI/180;
  const angleCargo=parseFloat(document.getElementById('angleCargo').value)*Math.PI/180;
  const num=parseInt(document.getElementById('num').value);
  const cargoWidth=2, cargoHeight=1, cargoDepth=2;
  const lashLen=2.5;

  const spacing=cargoHeight/(num+1);
  for(let i=1;i<=num;i++){
    const y=0.5 - cargoHeight/2 + spacing*i;

    // Port
    addLashing(-cargoWidth/2, y, -cargoDepth/2, -lashLen*Math.cos(angleDeck), -lashLen*Math.sin(angleDeck), 0, 0xffb347);
    // Starboard
    addLashing(cargoWidth/2, y, -cargoDepth/2, lashLen*Math.cos(angleDeck), -lashLen*Math.sin(angleDeck), 0, 0xffb347);
  }
}

function addLashing(x,y,z,dx,dy,dz,color){
  const mat=new THREE.LineBasicMaterial({color:color});
  const points=[new THREE.Vector3(x,y,z), new THREE.Vector3(x+dx,y+dy,z+dz)];
  const geom=new THREE.BufferGeometry().setFromPoints(points);
  const line=new THREE.Line(geom,mat);
  line.userData.lashing=true;
  scene.add(line);
}

document.getElementById('update').onclick=drawLashings;
</script>
</body>
</html>
